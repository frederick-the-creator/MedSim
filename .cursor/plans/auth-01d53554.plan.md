<!-- 01d53554-828d-4682-9835-289c24866104 a2bbfcd1-5df6-4c06-a5d8-2bec6d37794d -->
# Add Supabase Auth + Forms and Wire Buttons

## Scope

- Create `login`, `signup`, and `register-interest` pages inside subfolder `client/src/pages/auth/`.
- Integrate Supabase client-side auth (`@supabase/supabase-js`).
- Persist register-interest submissions to Supabase `public.profile` with RLS (allow anonymous insert).
- Update routing and wire buttons on `client/src/pages/landing.tsx` and defaults in `client/src/components/shared/Header.tsx`.
- Preselect discipline via `?discipline=` on register-interest when arriving from landing cards.

## Files to Add

- `client/src/lib/supabaseClient.ts` — export configured Supabase client using `VITE_SUPABASE_URL` and `VITE_SUPABASE_PUBLISHABLE_KEY`.
- `client/src/pages/auth/login.tsx` — email/password login via `supabase.auth.signInWithPassword`; toast success/error; redirect to `/home` on success.
- `client/src/pages/auth/signup.tsx` — email/password signup via `supabase.auth.signUp`; toast and show inline confirmation to check email; no redirect.
- `client/src/pages/auth/register-interest.tsx` — Name + Email + Discipline dropdown (from `@/data/disciplines`); discipline preselected from query; on submit `supabase.from('interests').insert(...)`; toast success; redirect to `/`.

## Files to Update

- `client/src/App.tsx` — add routes and import new pages from `pages/auth`:
  - `/login` → `pages/auth/login`
  - `/signup` → `pages/auth/signup`
  - `/register-interest` → `pages/auth/register-interest`
- `client/src/pages/landing.tsx` —
  - Replace no-op `handleClick` with navigation using `useLocation`.
  - Map `disciplines` to navigate:
    - Primary → `/signup?discipline=<encoded>`
    - Non-primary → `/register-interest?discipline=<encoded>`
  - Wire header `Log in` and `Sign up` buttons to `/login` and `/signup`.
- `client/src/components/shared/Header.tsx` — when `rightActions` is not provided and `showBackButton` is false, render `Link` buttons to `/login` and `/signup` globally.

## Key Snippets (illustrative)

- Supabase client (`client/src/lib/supabaseClient.ts`):
```ts
import { createClient } from '@supabase/supabase-js'

const supabaseUrl = import.meta.env.VITE_SUPABASE_URL as string
const supabasePublishableKey = import.meta.env.VITE_SUPABASE_PUBLISHABLE_KEY as string

export const supabase = createClient(supabaseUrl, supabasePublishableKey)
```

- Route additions (`client/src/App.tsx`):
```23:36:client/src/App.tsx
function Router() {
  return (
    <Switch>
      <Route path="/" component={Landing} />
      <Route path="/home" component={Home} />
      <Route path="/login" component={Login} />
      <Route path="/signup" component={Signup} />
      <Route path="/register-interest" component={RegisterInterest} />
      <Route path="/case/:id" component={CasePractice} />
      <Route component={NotFound} />
    </Switch>
  )
}
```

- Landing click handler and header buttons (`client/src/pages/landing.tsx`):
```12:26:client/src/pages/landing.tsx
export default function Landing() {
  const [, setLocation] = useLocation()
  const handleClick = (d: Discipline) => {
    const q = `?discipline=${encodeURIComponent(d.name)}`
    setLocation(d.isPrimary ? `/signup${q}` : `/register-interest${q}`)
  }
  // in Header rightActions
  <Button variant="ghost" onClick={() => setLocation('/login')}>Log in</Button>
  <Button onClick={() => setLocation('/signup')}>Sign up</Button>
}
```

- Discipline preselect (`client/src/pages/auth/register-interest.tsx`):
```ts
const params = new URLSearchParams(window.location.search)
const preset = params.get('discipline') || ''
const [discipline, setDiscipline] = useState(preset)
```

- Register interest insert:
```ts
await supabase.from('interests').insert({ name, email, discipline })
```


## Supabase setup

- Dependency: `@supabase/supabase-js`.
- Env (.env.local):
  - `VITE_SUPABASE_URL=...`
  - `VITE_SUPABASE_PUBLISHABLE_KEY=...` (publishable/anon public key)

### Interests table schema (SQL)

```sql
create extension if not exists pgcrypto;

create table if not exists public.interests (
  id uuid primary key default gen_random_uuid(),
  name text not null,
  email text not null check (email ~* '^[^@\s]+@[^@\s]+\.[^@\s]+$'),
  discipline text not null, -- specialty of interest
  created_at timestamptz not null default now()
);

alter table public.interests enable row level security;

-- Allow anonymous inserts from the client
create policy "allow_anon_insert" on public.interests
  for insert to public
  with check (true);

-- Optional: block selects for non-service roles
create policy "block_select_authenticated" on public.interests
  for select to authenticated
  using (false);

-- Optional: protect updates/deletes
create policy "block_update_delete_authenticated" on public.interests
  for update using (false)
  with check (false);
create policy "block_delete_authenticated" on public.interests
  for delete using (false);

-- Optional: ensure one interest per email+discipline
create unique index if not exists interests_email_discipline_unique
  on public.interests (lower(email), lower(discipline));
```

## UX Details

- Use `Input`, `Label`, `Select`, `Button` components.
- Flows:
  - Login → success toast → redirect `/home`.
  - Signup → success toast + message to check email; no redirect.
  - Register interest → success toast → redirect `/`.

## Out-of-scope

- Session-aware header and route guards (can be added later).

### To-dos

- [ ] Add Supabase client at client/src/lib/supabaseClient.ts
- [ ] Create login form page and connect to Supabase auth
- [ ] Create signup form page and connect to Supabase auth
- [ ] Create register interest page; insert into Supabase interests table
- [ ] Update client/src/App.tsx with /login, /signup, /register-interest routes
- [ ] Wire landing header buttons and cards to navigate to new routes w/ query
- [ ] Render login/signup links in Header when no rightActions/back button
- [ ] Add @supabase/supabase-js and configure VITE_SUPABASE_URL/VITE_SUPABASE_ANON_KEY
- [ ] Create Supabase table interests with name, email, discipline, created_at